# 网络斗地主

## 题目描述

本实验需要使用C语言socket编程。 采用客户端、服务端二分的模式，因此你需要编写**两个程序**。

**不要求实现图形界面。只要有能操作的字符界面即可。**

服务端：

- 监听某一个固定端口。
- 监听来自客户端发起的连接并返回请求的消息。
- 管理用户。简单的帐号密码登录即可。
- 管理对局。支持多桌同时对局。
- 维护对局中状态。包括玩家、座次、积分、手牌、出牌顺序。

客户端：

- 向一个（可能是远程的）服务端发送各种请求，包括登录、开启对局、获取自己的手牌、出牌...
- 将服务器返回的请求展示给用户：登录是否成功，对局排队等待几人，手牌有哪些，对手出了什么牌，自己的出牌是否合法。。。

期待的运行方式是：一台主机上运行服务端，三个用户分别运行自己的客户端向服务端发起连接，并发送请求。

游戏规则参考qq斗地主的普通模式。有叫地主、抢地主，3张底牌。牌型要匹配并比较大小。积分规则可以自定。

参考思路：

服务端创建监听线程。每接收到一个消息，将其放入一个全局队列中，等待处理。

另一个线程，while(1) 循环从队列中取一条消息，然后分析其中的内容

首先分析请求类型：登录、排队等待、房间信息（其他用户、座次、对手分数等）、对局信息（阶段（抢地主/加倍/牌局进行），当前轮到的用户，之前牌桌的操作序列，初始手牌或当前手牌，底牌，倍数...)、对局内操作（叫地主，抢地主，加倍，超级加倍，出牌，投降，（倒一杯卡布奇诺），...)。

之后根据请求类型：

- 认证用户和密码
- 有3人排队，则创建对局，用一个结构体存放，里面是可以确定对局状态的所有变量
- 修改对局状态
- 将结果信息返回给用户

对于客户端：

- 按照流程，先进行登录验证
- 通过后，可以由用户选择是否排队
- 排队成功后，则向服务端请求房间信息和对局信息
- 对局中，要不停地获取对局信息，向用户呈现
- 用户执行操作后，要向服务器发送

### 协议设计

网络编程可以参考蚂蚁老师B站的最新视频。在建立好连接之后，服务器和客户端就要开始通信了，通过 send() 和 recv() 这一对接口进行沟通。

人沟通要有语言，机器沟通也要约定好某个形式。比如当前客户端想要向服务端请求登录，如果客户端发送一段："I want to login, please!"，可能服务端完全不明白客户端在说什么。因此我们需要设计一套客户端和服务端之间的公用的“暗号”，例如：

```
client: login username=username password=password
server: ok token=...... / failure

client: getmycards   // 获取手牌
server: failure / ok cards=A23H456S789C10JQKD     // Heart Spade Club Diamond

client: playcard cards=3H456S7C    // 打出一个顺子
server: ok

client: playcard card=joker1    // 出大王
server: failure: you don't have it
```

注释：我推荐在登录成功后，服务端随机返回一个随机生成的，独一无二的token字符串给用户，之后用户都用这一字符串来验证身份。当用户登出，只需要服务端无效化这个token，用户就不能验证身份，处于离线状态了，直到下一次重新登录。

这只是一个简陋的参考设计。你可以选择更好的形式，比如 `JSON`

```json
client: {"type":"login","username":"username","password":"password"}
server: {"state":true,"token":"somerandomstring"}

client: {"type":"getmycards"}
server: {"state":true,"cards":["AH","2H","3H","4H",...]}
```

这样的格式就非常清晰，键-值一一对应，解析时不容易出错，比如把下一个参数的内容也包含到这一参数的值来。

## 输入格式

## 输出格式

## 脚注

## 样例输入

## 样例输出
